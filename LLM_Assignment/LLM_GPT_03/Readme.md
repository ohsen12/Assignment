# 💡Chain-of-Thought (CoT) & Retrieval-Augmented Generation (RAG) 

## 개요

현대 AI에서 더 나은 추론, 검색, 생성 능력을 확보하는 것은 매우 중요하다. 
**Chain-of-Thought (CoT)** 와 **Retrieval-Augmented Generation (RAG)** 은 모델의 성능을 개선하기 위해 추론 과정을 강화하고 외부 지식을 검색하여 답을 생성하는 기술이다. 
아래에서는 각 기술의 개념, 동작 원리, 장단점, 실제 적용 사례 등을 상세히 설명한다.

---

## 목차

1. [Chain-of-Thought (CoT)](#chain-of-thought-cot)
    1.1 [개념](#개념)  
    1.2 [작동 원리](#작동-원리)  
    1.3 [적용 사례](#적용-사례)  
    1.4 [장점과 한계](#장점과-한계)
2. [Retrieval-Augmented Generation (RAG)](#retrieval-augmented-generation-rag)
    2.1 [개념](#개념-1)  
    2.2 [작동 원리](#작동-원리-1)  
    2.3 [적용 사례](#적용-사례-1)  
    2.4 [장점과 한계](#장점과-한계-1)
3. [CoT와 RAG 비교](#cot와-rag-비교)
4. [결론](#결론)
5. [프로젝트에서의 CoT 기법 적용](#프로젝트에서의-cot-기법-적용)

---

## Chain-of-Thought (CoT)

### 개념

**Chain-of-Thought (CoT)** 는 문제를 해결할 때 **중간 단계나 "사고의 흐름"을 명확하게 드러내는 기법**이다. 
즉, 모델은 답을 바로 도출하지 않고 문제를 해결하는 과정에서 각 단계를 나열하여 최종 결론에 도달한다. 이러한 방식은 복잡한 추론 문제를 해결할 때 도움이 되며, 모델의 결과에 대한 설명 가능성을 높여준다.

### 작동 원리

**CoT는 모델이 문제에 대한 답을 도출하기 전에 문제 해결 과정을 단계별로 명확하게 설명하게끔 유도한다.**
 예를 들어 수학 문제에서 모델은 필요한 연산을 먼저 나열하고 중간 계산을 한 뒤, 최종 답을 도출하는 방식이다.

**예시:**

문제: 12 + 7은 무엇인가요? 

- 1단계: 12와 7을 더하는 문제임을 이해. 
- 2단계: 12 + 7 = 19. 
- 최종 답: 19


이 예시에서는 문제 해결의 과정을 명확히 제시함으로써 추론이 어떻게 이루어졌는지 쉽게 이해할 수 있다.

### 적용 사례

- **복잡한 추론 문제 해결**: 수학 문제나 논리 퍼즐, 언어 이해와 같이 여러 단계를 거쳐야 하는 문제를 해결할 때 유용하다.
- **설명 가능성 향상**: **모델의 추론 과정을 명확하게 보여주어 결과를 더 잘 이해하고 신뢰할 수 있다.**
- **오류 분석**: 모델의 사고 과정을 추적하여 오류가 발생한 부분을 쉽게 찾아낼 수 있다.

### 장점과 한계

**장점:**
- **투명성**: 모델의 추론 과정을 더 잘 이해할 수 있다.
- **정확성 향상**: 문제를 여러 단계로 나누어 해결하면 더 정확한 답을 도출할 수 있다.
- **디버깅 용이**: 중간 과정을 추적하여 오류가 발생한 지점을 쉽게 파악할 수 있다.

**한계:**
- **효율성 문제**: **CoT가 여러 단계의 추론을 요구하므로 계산 시간이 길어질 수 있다.**
- **과도한 복잡성**: 간단한 문제에 대해서는 불필요하게 복잡한 과정이 될 수 있다.

---

## Retrieval-Augmented Generation (RAG)

### 개념

**Retrieval-Augmented Generation (RAG)** 은 **검색**(retrieval)과 **생성**(generation)을 결합한 접근법이다. 
이 방식에서는 모델이 질문에 대한 **답을 생성할 때 외부 데이터나 문서에서 관련 정보를 검색하고, 그 정보를 바탕으로 답변을 생성**한다. 
이를 통해 모델은 **사전 학습된 지식뿐만 아니라, 실시간으로 검색된 외부 정보를 활용**해 더 정확하고 최신의 답을 제공할 수 있다.

### 작동 원리

RAG는 두 단계로 작동한다:
1. **검색**: 모델은 먼저 외부 지식베이스나 검색 엔진을 통해 질문에 관련된 정보를 검색한다.
2. **생성**: 검색된 정보를 바탕으로 모델은 적절한 답변을 생성한다.

예를 들어 최신 뉴스에 관한 질문을 받았을 때, 모델은 최신 기사를 검색하고 그 정보를 바탕으로 답변을 생성한다.

**예시:**

문제: 최근 Mars 미션에 대한 업데이트는? 

- 1단계: Mars 미션에 대한 최신 뉴스 검색. 
- 2단계: 가장 관련 있는 기사를 검색하여 정보를 확인.
- 3단계: 검색된 정보를 바탕으로 답변 생성: "Mars 미션은 Perseverance 로버를 성공적으로 착륙시켰으며, 로버는 Jezero 분화구에서 고대 생명체의 흔적을 탐사하고 있습니다." 
- 최종 답: Mars 미션은 Perseverance 로버를 성공적으로 착륙시켰으며, 로버는 Jezero 분화구에서 고대 생명체의 흔적을 탐사하고 있습니다.

### 적용 사례

- **최신 정보 제공**: 최신 뉴스나 실시간 정보가 필요한 작업에 유용하다.
- **정확한 답변 생성**: 다양한 외부 자원을 활용하여 더 정확하고 풍부한 답을 제공할 수 있다.
- **확장성**: 외부 지식베이스가 커질수록 모델의 성능도 향상된다.

### 장점과 한계

**장점:**
- **실시간 정보 반영**: 최신의, 혹은 동적인 정보를 반영할 수 있다.
- **정확성 향상**: 외부 정보를 사용함으로써 더 정확한 답변을 제공할 수 있다.
- **풍부한 답변**: 검색된 정보에서 더 많은 세부 사항을 포함한 답을 제공할 수 있다.

**한계:**
- **검색 시스템 의존**: **검색된 정보의 질이 중요하므로 검색 시스템이 잘 작동해야 한다.**
- **노이즈**: 검색된 정보 중 관련 없는 내용이 포함될 수 있다.
- **처리 지연**: 검색 단계에서 시간이 추가될 수 있다.

---

## CoT와 RAG 비교

**CoT**와 **RAG**은 AI 모델의 성능을 개선하는 두 가지 중요한 접근법이지만, 각각 다른 측면에 초점을 맞추고 있다. 아래는 두 기법을 비교한 표다:

| **항목**               | **Chain-of-Thought (CoT)**                    | **Retrieval-Augmented Generation (RAG)**              |
|------------------------|------------------------------------------------|--------------------------------------------------------|
| **초점**                | 논리적 추론과 문제 해결 과정의 명확한 표현.   | 외부 정보 검색을 통한 정확한 답변 생성.             |
| **적용 사례**           | 다단계 추론 문제 해결 (예: 수학, 논리 문제).  | 최신 정보가 필요한 문제 해결 (예: 뉴스, 의료 데이터). |
| **외부 정보 의존**      | **외부 정보 없이 내부 추론만 사용.**              | **외부 지식베이스나 검색 시스템에 의존.**                 |
| **투명성**              | 높은 투명성, 모델의 사고 과정이 명확히 드러남. | 검색된 정보의 질에 따라 투명성이 달라짐.            |
| **효율성**              | **복잡한 문제에서 느려질 수 있음.**               | **검색 과정에 따른 지연 시간이 발생할 수 있음.**         |

---

## 결론

**Chain-of-Thought (CoT)** 와 **Retrieval-Augmented Generation (RAG)** 은 AI 모델의 능력을 확장하는 데 중요한 역할을 한다. 

**CoT**는 모델이 **자기 추론** 과정을 명확하게 나열하고 중간 단계를 거쳐 답을 생성하는 방법에 집중한다. 주로 다단계 문제 해결에 적합하다.

**RAG**는 **외부 지식을 검색**해서 그 정보를 바탕으로 답을 생성하는 방식으로, 실시간 정보나 지식 집약적인 작업에서 유용하다.

두 기법은 각각 다른 방식으로 모델의 성능을 향상시키며, 많은 경우 두 기법을 결합하면 최적의 결과를 얻을 수 있다.

---

## 추가 자료

1. [CoT 논문: "Chain-of-Thought Prompting Elicits Reasoning in Large Language Models"](https://arxiv.org/abs/2201.11903)

   <details>
       <summary>
           논문 정보
       </summary>

      이 논문은 Chain-of-Thought (CoT) 기법을 사용하여 대형 언어 모델이 더 나은 추론을 할 수 있도록 유도하는 방법을 설명한다. 특히, 복잡한 문제를 풀 때 모델이 중간 단계를 명시적으로 추론하고 문제를 단계별로 해결하게끔 유도하는 방식이다.

      CoT 기법은 모델이 답을 즉시 도출하지 않고, 중간 사고 과정을 거쳐서 점진적으로 결론에 도달하는 과정을 생성하도록 유도한다. 이를 통해 모델이 보다 복잡한 문제나 다단계 문제를 해결할 수 있으며, 모델의 추론 과정에 대한 투명성을 높여준다.

      이 논문에서는 CoT가 모델의 추론 능력을 개선하고, 더 정확한 답변을 도출하게 만들 수 있다는 실험 결과를 제공한다. 예를 들어, 수학 문제나 논리적 퍼즐 등에서 중간 단계의 사고를 명확히 하는 방식이 유효하다는 점을 입증한다.

   </details>

2. [RAG 논문: "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks"](https://arxiv.org/abs/2005.11401)

    <details>
       <summary>
           논문 정보
       </summary>

      이 논문에서는 Retrieval-Augmented Generation (RAG) 기법을 제안하고, 이를 지식 집약적인 NLP 작업에 어떻게 적용할 수 있는지에 대해 설명한다. RAG는 기존의 생성적 모델(예: GPT)과 검색 모델을 결합하여 외부 지식을 검색하고, 그 지식을 바탕으로 더 정확하고 풍부한 답변을 생성하는 방법이다.

      이 연구는 RAG가 단순한 생성 모델보다 더 효율적이고 정확하게 답을 생성할 수 있음을 보여준다. 예를 들어, 최신 뉴스나 특정 분야의 지식이 필요한 경우, 모델은 먼저 외부에서 정보를 검색하고, 그 정보를 바탕으로 더 정확한 답변을 만들어낸다.

      논문에서는 RAG의 두 가지 주요 단계—검색과 생성—을 설명하고, 이를 퀴즈 답변, 문서 요약, 질의 응답 시스템 등 여러 작업에 적용한 실험 결과를 제시한다. 또한, 검색된 정보를 어떻게 활용할지에 대한 세부적인 전략도 다룬다.

   </details>

---

## 프로젝트에서의 CoT 기법 적용

[main1.py](https://github.com/ohsen12/Assignment/blob/main/LLM_Assignment/LLM_GPT_03/main/main1.py) 에서는 프롬프트를 한 가지 직무에 대해서 길고 상세하게 작성하여 GPT 모델을 실행하고,
[main2.py](https://github.com/ohsen12/Assignment/blob/main/LLM_Assignment/LLM_GPT_03/main/main2.py) 에서는 main1.py의 프롬프트에 CoT 기법을 적용하여 각 업무를 수행해야 하는 이유와 목적을 단계적으로 설명한다.

### 두 프롬프트의 차이점

##### 이유와 목적 설명:
CoT 기법을 적용한 프롬프트에서는 각 업무를 수행해야 하는 이유와 목적을 단계적으로 설명하고 있다. 
예를 들어, "고객이 카페에 들어오면 반갑게 인사를 하며, 친절하게 맞이해야 한다." 라고 설명한 후, 그 이유를 **"이는 고객이 카페에 대한 첫 인상을 형성하는 중요한 순간이기 때문입니다."** 라고 덧붙여 설명한다.
이렇게 이유를 설명함으로써 각 행동의 목적과 중요성을 명확하게 전달한다.

##### ⭐️ 사고의 흐름 추가:
CoT 방식에서는 각 작업을 할 때 어떻게 해야 하는지 뿐만 아니라 왜 그런 방식으로 해야 하는지도 함께 설명한다. 
예를 들어, 음료 준비 시, **"정확한 레시피를 따르는 이유는, 고객이 기대하는 품질의 음료와 음식을 제공하기 위함입니다."** 라는 식으로 추가적인 사고의 흐름을 설명하여 작업의 의미를 더 깊이 있게 파고든다.

##### 결과와 영향:
각 업무의 결과가 어떻게 카페의 운영에 영향을 미치는지에 대한 설명이 추가된다. 
예를 들어, "고객이 음료나 음식에 불만이 있을 경우, 이를 신속하게 해결하고, 고객에게 사과의 말을 전해야 한다."라고 적고, 그 이유는 **"불만을 처리하는 방식이 고객의 재방문을 결정짓는 중요한 요소가 될 수 있습니다."** 라고 덧붙여, 고객과의 관계에서의 중요성을 강조한다.

##### 요약:
CoT 기법을 적용한 프롬프트는 각 작업을 수행하는 이유와 그 행동이 카페 운영에 미치는 영향을 **논리적이고 단계적으로 설명하여 모델이 각 업무를 이해하고 연결하는 데 도움을 주는 방식**으로 작성되었다.
