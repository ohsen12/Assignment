### 📝 LLM과 Django 실습

기존의 퓨어 장고 프로젝트(django로 간단한 웹페이지 구현)를 확장하여, OpenAI의 API 사용하기

- API와 Django에 대한 이해가 선행되어야 한다.
- HTTP 메서드로 API를 호출하는 법을 학습한다.

참고 링크
- [API 상세](https://tpsdms12.tistory.com/148)
- [API 호출 방식의 차이 간단 요약](https://tpsdms12.tistory.com/149)


### 🤖 chatbot 앱

기존 프로젝트에 추가해야 할 chatbot 앱은, **Django**를 사용하여 **GPT-3.5-turbo 모델**과 상호작용하는 **챗봇 애플리케이션**이다. 사용자가 입력한 대화 내용은 **세션**에 저장되며, **대화 기록은 DB에 저장**되어 언제든지 조회하고 삭제할 수 있는 기능을 제공한다.

#### 주요 기능

##### 1. 대화 저장 및 GPT 모델과 상호작용
- 사용자가 채팅 입력 폼을 제출하면, 해당 입력은 OpenAI의 **GPT-3.5-turbo 모델**에 전달되어 응답을 받는다.
- 응답은 `gpt_response` 변수에 저장되고, 사용자의 입력과 GPT 모델의 응답은 **세션**에 저장되어 대화 흐름을 유지한다.
- 대화가 완료되면, **DB에 대화 기록**이 저장된다. 각 대화는 `Message` 모델을 통해 **사용자**와 **GPT의 응답**이 기록된다.

##### 2. 세션을 활용한 대화 흐름 유지
- 세션은 사용자의 대화 흐름을 유지하는 데 사용된다. 사용자가 첫 대화를 시작할 때 기본적으로 시스템 메시지(챗봇의 역할)에 대한 정보가 세션에 저장된다.
- 세션은 사용자가 채팅하는 동안 지속되며, 브라우저를 닫거나 세션 만료 전까지 **대화 기록을 유지**한다. **세션을 통해 사용자는 과거의 대화 내용을 기반으로 연속적인 대화를 나눌 수 있다.**

##### 3. 대화 기록
- 사용자가 주고받은 대화는 **`Message` 모델**에 저장된다. 이 모델은 사용자의 대화와 GPT의 응답을 `user`와 `gpt_response` 필드를 통해 DB에 기록한다.
- 사용자는 **`chat_history` 뷰**를 통해 대화 기록을 확인할 수 있다. 이 뷰는 로그인한 사용자에 해당하는 **대화 기록을 최신순**으로 DB에서 불러와 템플릿에 전달하여 화면에 표시한다.

##### 4. 대화 기록 삭제
- 사용자는 자신의 대화 기록을 삭제할 수 있다. `chat_delete` 뷰는 **POST 요청**으로 대화 기록을 **전체 삭제**한다.

#### 뷰 흐름

##### 1. `chat_view` 뷰
- 사용자가 대화 입력 폼을 제출하면, 사용자가 입력한 메시지와 GPT 모델의 응답을 **세션에 저장**한다.
- 대화 내용은 **DB에 저장**되어 사용자가 언제든지 **대화 기록을 조회**할 수 있다.

##### 2. `chat_history` 뷰
- 사용자는 `chat_history` 뷰에서 본인의 대화 기록을 **최신순**으로 조회할 수 있다. DB에 저장된 대화는 **`Message` 모델**을 통해 불러온다.

##### 3. `chat_delete` 뷰
- 사용자는 `chat_delete` 뷰를 통해 **자신의 대화 기록을 삭제**할 수 있다.

#### 사용된 기술

- **OpenAI API**: GPT-3.5-turbo 모델을 사용하여 대화 응답을 생성한다.
- **Django 세션**: 사용자마다 대화의 흐름을 기억하기 위해 사용된다.
- **Django ORM (Message 모델)**: 대화 내용은 데이터베이스에 저장되어 나중에 조회할 수 있다.

#### 실행 방법

1. `.env` 파일에 OpenAI API 키를 설정한다.
2. Django 프로젝트를 실행하고 웹 브라우저에서 챗봇을 사용한다.
3. 사용자는 채팅 입력 폼을 통해 대화를 시작하고, 챗봇의 응답을 받을 수 있다.
4. 대화 기록은 DB에 저장되고, `chat_history` 뷰에서 조회할 수 있다.
5. 대화 기록 삭제는 `chat_delete` 뷰를 통해 가능하다.


#### 추가 설명

- **세션**: 각 사용자는 자신만의 대화 흐름을 유지하며, 세션은 브라우저를 닫거나 세션 만료 전까지 지속된다.
- **DB와 세션의 차이**: DB에 저장된 대화 기록은 사용자가 로그아웃하더라도 삭제되지 않으며, 세션에 저장된 대화 흐름은 사용자가 로그아웃하면 초기화된다.






